@page "{referencia}"
@using Microsoft.Extensions.Configuration
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery
@inject IConfiguration Configuration
@{
    Layout = "_Layout";
}
<div class="nk-content-body">
    <div class="components-preview wide-md mx-auto">
        <div class="nk-block nk-block-lg">
            <div class="nk-block-head">
                <div class="nk-block-head-content">
                    @if (this.ViewBag.Details is null)
                    {
                        <h4 class="title nk-block-title">Registro de Roles</h4>
                    }
                    else
                    {
                        <h4 class="title nk-block-title">Actualizar Roles</h4>
                    }
                </div>
            </div>

            <form class="form-validate is-alter" id="roles-form" method="post" enctype="multipart/form-data" asp-controller="A02Roles" asp-action="Create">
                <div class="card card-bordered card-preview">
                    <div class="card-inner">
                        <div class="preview-block">
                            <span class="preview-title-lg overline-title">Capture la información del Rol.</span>
                            <div class="row gy-4">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="form-group">
                                        <div class="form-control-wrap">
                                            <div class="form-icon form-icon-right xl">
                                                <em class="icon ni ni-user"></em>
                                            </div>
                                            <input type="text" class="form-control form-control-xl form-control-outlined" id="idrol" name="idrol" value="@(this.ViewBag.Details is null ? "" : this.ViewBag.Details.IdRol)">
                                            <label class="form-label-outlined" for="outlined-normal">ID Rol</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6">
                                    <div class="form-group">
                                        <div class="form-control-wrap">
                                            <div class="form-icon form-icon-right xl">
                                                <em class="icon ni ni-coin-alt"></em>
                                            </div>
                                            <input type="number" class="form-control form-control-xl form-control-outlined" id="salario" name="salario" value="@(this.ViewBag.Details is null ? "" : this.ViewBag.Details.Salario)">
                                            <label class="form-label-outlined" for="outlined-normal">Salario x Hora (MXN)</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-12 col-sm-6">
                                    <div class="form-group">
                                        <div class="form-control-wrap">
                                            <div class="form-icon form-icon-right xl">
                                               <em class="icon ni ni-view-row-wd"></em>
                                            </div>
                                            <input type="text" class="form-control form-control-xl form-control-outlined" id="descripcion" name="descripcion" value="@(this.ViewBag.Details is null ? "" : this.ViewBag.Details.DescripcionRol)">
                                            <label class="form-label-outlined" for="outlined-normal">Descripción</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-sm-6">
                                    <div class="preview-block">
                                        <span class="preview-title overline-title">Active o desactive el estatus del Rol.</span>
                                        <div class="custom-control custom-checkbox checked">
                                            <input type="checkbox" class="custom-control-input" id="estatus" name="estatus">
                                            <label class="custom-control-label" for="estatus">Estatus</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row pt-4">
                                <div class="row pt-4">
                                    @if (this.ViewBag.Details is null)
                                    {
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-lg btn-primary btn-block">Registrar</button>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="form-group">
                                            <button type="button" onclick="Update()" class="btn btn-lg btn-primary btn-block">Actualizar</button>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
@section scripts  {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>
    <script>

        function Update() {
            fetch(`/A02Roles/Update`, {
                method: 'PUT',
                headers: {
                    'Content-type': 'application/json',
                },
                body: JSON.stringify({
                    Id: @(this.ViewBag.Details is null ? 0 : this.ViewBag.Details.Id),
                    IdRol: '@this.ViewBag.Details' == null ? 0 : $("#idrol").val(),
                    DescripcionRol: $("#descripcion").val(),
                    Salario: $("#salario").val(),
                    Estatus: 1,///$("#estatus").val(),
                    CreatedBy: '',
                    CreatedOn: moment().toISOString(),
                    LastModifiedBy: '',
                    LastModifiedOn: moment().toISOString()
                })
            }).then(function (response) {
                if (response.ok) {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Guardado correctamente',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    setTimeout(function () {
                        window.location.href = '/A02Roles';
                    }, 1000);
                    return response.json();
                }
                return Promise.reject(response);
            }).then(data => {
                console.log('Success:', id);
            }).catch(function (error) {
                console.log('BLAH BLAH BLAH', error);
            });
        }

        $("#roles-form").validate({
            rules: {
                // compound rule
                idrol: { required: true },
                descripcion: { required: true },
            },
            submitHandler: function (form) {
                let uniqueId = Date.now().toString(36) + Math.random().toString(36).substring(2);

                fetch(`/A02Roles/Create`, {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json',
                    },
                    body: JSON.stringify({
                        Id: 0,
                        IdRol: $("#idrol").val(),
                        Salario: $("#salario").val(),
                        DescripcionRol: $("#descripcion").val(),
                        Estatus: 1,
                        CreatedBy: '',
                        CreatedOn: moment().toISOString(),
                        LastModifiedBy: '',
                        LastModifiedOn: moment().toISOString()
                    })
                }).then(function (response) {
                    if (response.ok) {
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Guardado correctamente',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        setTimeout(function () {
                            window.location.href = '/A02Roles';
                        }, 1000);
                        return response.json();
                    }
                    return Promise.reject(response);
                }).then(data => {
                    console.log('Success:', id);
                }).catch(function (error) {
                    console.log('BLAH BLAH BLAH', error);
                });
            }
        });
    </script>

}